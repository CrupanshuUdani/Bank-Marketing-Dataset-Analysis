---
title: "Preprocessing Bank Marketing Data"
author: Crupanshu Udani
date: 09/05/20
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo=TRUE,warning = FALSE)
```

## Importing libraries
```{r Importing Library}
library(dplyr)
print("All Libraries loaded")
```
## Reading the dataset
```{r Importing Dataset}
dataset <- read.csv('../data/bank-additional-full.csv',header = TRUE,sep = ';',na.strings = c("","NA","unknown"))
summary(dataset)
```
# 1. Preprocessing data
## 1.1 Cleaning Data
As a part of this step we'll be removing all the rows that contain NA values ( i.e. unknown in original dataset).
```{r}
data <- na.omit(dataset)
dim(data)
```
## 1.2 Exploring Data
As a part of this step we would be exploring each data field and checking the values.

#### Age:
```{r Age}
data$age<-as.integer(data$age)
hist(data$age)
boxplot(data$age,horizontal = T,xlab = "Age",main="Box plot of Age distributution")
#abline(v=37.00,col="lightgrey")
#text(37, 10, "37.00", col = "darkgrey")
```

Summary: Age data is mostly skewed towards lower,middle age groups thus older age group could cause issue in the model.

#### Job
```{r Job}
job <- table(data$y,data$job)
barplot(job,names.arg = names(job),legend.text = rownames(job),xlab = "Job",ylab = "Count")
```

#### Marital
```{r Marital}
marital <- table(data$y,data$marital)
barplot(marital,legend.text = rownames(marital))
```

#### Education
```{r Education}
education <- table(data$y,data$education)
barplot(education, legend.text = rownames(education))
```

As per graph and data clearly for education *illiterate* has very low no of row of data (only **`r data %>% filter(education == "illiterate") %>% count()`)**. **TODO:: Need to handle that Field**

#### Default
```{r Default Field}
table(data$default)
```

Clearly for attribute *default* has only `r filter(data,default=="yes") %>% count()` rows with yes field. So the field would not be useful. Therefore the field can be dropped.

#### Housing
```{r housing}
housing <- table(data$y,data$housing)
barplot(housing,legend.text = rownames(housing))
```

#### Loan
```{r loan}
loan <- table(data$y,data$loan)
barplot(loan,xlab = "Loan",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```

#### Contact
```{r Contact}
contact <- table(data$y,data$contact)
barplot(contact,xlab = "Contact",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```

#### Month
```{r Month}
month <- table(data$y,data$month)
barplot(month,xlab = "Month",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```
#### Day of Week
```{r Day of Week}
day_of_week <- table(data$y,data$day_of_week)
barplot(day_of_week,xlab = "Day of Week",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```

#### Duration
```{r Duration}
duration <- table(data$duration)
barplot(duration,xlab = "Duration",ylab = "Frequency")
boxplot(data$duration,horizontal = T)
```

The above plots clearly shows that there are more number of calls that has happened for shorted duration then larger duration.

#### Campaign
```{r Campaign}
data$campaign <- as.integer(data$campaign)
campaign <- table(data$y,data$campaign)
barplot(campaign,xlab = "Campaign",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```

The above plot clearly shows there is more data for campaign with less contact and very less data with more contacts done.

#### pdays
```{r pDays}
data$pdays<-as.integer(data$pdays)
pdaysCount <- table(data$pdays)
barplot(table(data$pdays),xlab = "pdays",ylab = "Frequency")
data %>% select(pdays) %>% filter(pdays == 999) %>% count()
```

#### Previous
```{r Previous }
data$previous <- as.integer(data$previous)
previous <- table(data$y,data$previous)
barplot(previous,xlab = "Previous",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
```

#### pOutcome
```{r pOutcome}
poutcome <- table(data$y,data$poutcome)
barplot(poutcome,xlab = "poutcome",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
plot(poutcome,main = "Mosaic plot of poutcome and y values",xlab = "y",ylab = "poutcome")
```

#### Social and Economical Context
```{r Social & Economical attribute}
## emp.var.rate
emp.var.rate <- table(data$y,data$emp.var.rate)
barplot(emp.var.rate,xlab = "emp.var.rate",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
boxplot(data$emp.var.rate,horizontal = T,main ="Box plot of emp.var.rate")
## cons.price.idx
cons.price.idx <- table(data$y,data$cons.price.idx)
barplot(cons.price.idx,xlab = "cons.price.idx",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
boxplot(data$emp.var.rate,horizontal = T,main ="Box plot of cons.price.idx")
## cons.conf.idx
cons.conf.idx <- table(data$y,data$cons.conf.idx)
barplot(cons.conf.idx,xlab = "cons.conf.idx",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
boxplot(data$emp.var.rate,horizontal = T,main ="Box plot of cons.conf.idx")
## euribor3m
euribor3m <- table(data$y,data$euribor3m)
barplot(euribor3m,xlab = "euribor3m",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
boxplot(data$euribor3m,horizontal = T,main ="Box plot of cons.price.idx")
## nr.employed
nr.employed <- table(data$y,data$nr.employed)
barplot(nr.employed,xlab = "nr.employed",ylab = "Frequency",legend.text = c("no in  y","yes in y"))
boxplot(data$nr.employed,horizontal = T,main ="Box plot of nr.employed")
```

## Changing the categorical/logical data to factors
```{r}
data$job<-as.factor(data$job)
data$marital<-as.factor(data$marital)
data$education<-as.factor(data$education)
data$default<-as.factor(data$default)
data$housing<-as.factor(data$housing)
data$loan<-as.factor(data$loan)
data$contact<-as.factor(data$contact)
data$month<-as.factor(data$month)
data$day_of_week<-as.factor(data$day_of_week)
data$poutcome<-as.factor(data$poutcome)
data$y<-as.logical(data$y=="yes")
```

## Check Similarity matrix ::TODO
```{r}
X <- subset(data,select = age:nr.employed) %>% data.matrix()
Y <- data$y
cov_X <- cov(X)
cor_X <- cov2cor(cov_X)
#print(cov_X)
print(cor_X)
```

## Removing attributes and improper data
```{r}
data$pdays<-NULL
data$default<-NULL
```

## Do Dimensionality Reduction ::TODO
```{r}
pca_data<-prcomp(X,center = TRUE,scale. = TRUE)
print(pca_data)
```

## Sampling Dataset
```{r}
set.seed(110) # Team 11
dataSampleindex <- sample(1:nrow(data),10000)
sampled_data <- data[dataSampleindex, ]
dim(sampled_data)
```

```{r CleanWS, include = FALSE}
### Clean Env and Packages data
#rm(list= ls())
```

